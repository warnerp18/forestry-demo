@mixin bar-graph() {
  $breakpoint: tablet-small;
  $graph-axis-color: get-color(grey, 2x-light);
  $group-label-color: get-color(grey, light);
  $bar-tip-width: 2px;
  $group-label-font: 1rem;

  $max-width-mobile: 35rem;
  $max-item-height-mobile: 1.5rem;
  $group-label-width-mobile: 3rem;
  $bar-margin-bottom-mobile: 1rem;
  $item-left-padding-mobile: 0.5rem;

  $max-width-desktop: 100%;
  
  $max-item-height-desktop: 100%;
  $group-min-height-desktop: 17rem;
  $item-bottom-padding-desktop: 0.25rem;
  $item-min-width-desktop: 2.5rem;
  $group-padding-horizontal-desktop: 1.5rem;
  $group-label-padding-desktop: 0.5rem;
  $group-label-height-desktop: ($group-label-padding-desktop * 2) + $group-label-font;

  .bar-graph {
    max-width: $max-width-mobile;
    padding: 0;
    margin: 0 auto;

    list-style: none;

    @supports (display: flex) {
      @include from($breakpoint) {
        display: flex;
        justify-content: space-between;
        width: 100%;
        max-width: $max-width-desktop;
        
        margin-bottom: $group-label-height-desktop; // label is absolutely positioned below graph so we need this to make space for it

        border-bottom: solid 1px $graph-axis-color;
      }
    }
  }

  .bar-graph > * {
    @supports (display: flex) {
      @include from($breakpoint) {
        flex-grow: 1;
      }
    }
  }

  .bar-graph__group {
    position: relative;

    padding: 0 0 0 $group-label-width-mobile;  // label is absolutely positioned so need this to make space for it

    margin: 0 0 $bar-margin-bottom-mobile;

    list-style: none;

    @supports (display: flex) {
      @include from($breakpoint) {
        display: flex;
        align-items: stretch;
        justify-content: center;

        min-height: $group-min-height-desktop;

        padding: 0 $group-padding-horizontal-desktop;
        margin-bottom: 0;
      }
    }
  }

  //  to create vertical axis, we add a border to each group element.
  .bar-graph__group::after {

    position: absolute;
    top: 0;
    left: $group-label-width-mobile;

    height: calc(100% + #{$bar-margin-bottom-mobile});

    border-right: solid 1px $graph-axis-color;

    content: "";

    @include from($breakpoint) {
      content: initial;
    }
  }
  
  //  axis for first group on mobile only
  .bar-graph > li:first-child .bar-graph__group::after {
    $height: $bar-margin-bottom-mobile * 2;
    top: -1 * $bar-margin-bottom-mobile;

    height: calc(100% + #{$height});
  }

  //  year label
  .bar-graph__group::before {
    position: absolute;
    top: 50%;
    bottom: 0;
    left: 0;
    
    height: $group-label-font;

    font-size: $group-label-font;
    
    line-height: 1;

    color: $group-label-color;

    text-align: center;

    content: attr(data-label);
    transform: translateY(-50%);

    @supports (display: flex) {
      @include from($breakpoint) {
        top: 100%;
        right: 0;

        width: 100%;

        padding-top: $group-label-padding-desktop;
        padding-bottom: $group-label-padding-desktop;

        transform: initial;
      }
    }
  }

  .bar-graph--contrast .bar-graph__group::before {
    color: transparentize(get-color(white), 0.3);
  }

  .bar-graph__item {
    position: relative;

    display: block;
    width: 100%;
    padding: 0;

    line-height: 1.5rem;

    @supports (display: flex) {
      @include from($breakpoint) {

        min-width: $item-min-width-desktop;
      }
    }
  }

  .bar-graph__item span {
    display: block;
    max-height: $max-item-height-mobile;
    
    padding: 0 0 0 $item-left-padding-mobile;

    border-style: solid;
    border-width: 0 $bar-tip-width 0 0;

    @supports (display: flex) {
      @include from($breakpoint) {
        position: absolute;
        bottom: 0;
        left: 0;

        display: flex;
        align-items: flex-end;
        justify-content: center;

        width: 100% !important; // stylelint-disable-line declaration-no-important
        
        max-height: $max-item-height-desktop;
        
        padding: 0 0 $item-bottom-padding-desktop;

        border-width: $bar-tip-width 0 0;
      }
    }
  }

  .no-flexbox .bar-graph__item span,
  .bar-graph--contrast .bar-graph__item span {
    color: get-color(white);
  }

  .bar-graph__item--blue span {
    @include graph-color(blue, base, $breakpoint);
  }

  .bar-graph__item--green span {
    @include graph-color(green, base, $breakpoint);
  }
}
