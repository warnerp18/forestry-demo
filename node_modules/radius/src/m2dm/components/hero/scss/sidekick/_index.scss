/**
 * section: M2DM/components/hero/sidekick
 * title: Hero sidekick
 *
 * activateComponent: radius-component-hero-sidekick
 *
 * purpose: Use to display content which complements the hero or needs to be above the fold.
 *
 * description: |
 *   The hero is paired with the sidekick, which is a bar that sits below the component and is slightly inset.
 *
 *   On mobile, there is no inset and the sidekick just takes up the full width and sits below the hero, like any other element.
 *
 *   ### To use it:
 *   - Add the sidekick markup as per the example below. Note it is a separate `section`, rather than a child within the hero section
 *   - Give the hero itself a modifier class of `hero--with-sidekick` (this will increase bottom padding of the hero so the sidekick doesn't overlap any hero content)
 *   - Use the `hero-sidekick-customisation` mixin to declare the sidekick background colour, and the background underneath the sidekick (should be the same background colour of the next section on the page)
 *
 *   ## Alternate version
 *
 *   An alternative version of the sidekick is also available by adding the modifier class `hero-sidekick--alt` to the sidekick element.
 *   This version differs from the main one in that it actually overlaps the following element.
 *   The reason for this alt version is so as to be able to overlap following elements that have background images.
 *   The second argument to the customisation mixin will be ignored for this version of the sidekick.
 *   The one constraint with the alt version of the sidekick is that it needs to contain as its first and only child a `div` element (There are no restrictions on the content of this element).
 *
 * sassUsage: |
 *
 *   @include radius-component-hero-sidekick;
 *
 *   .hero-sidekick {
 *       @include hero-sidekick-customisation(get-color(purple), get-color(yellow, light));
 *   }
 *
 *
 * layout: components/hero/scss/sidekick/example
 * markup: components/hero/scss/sidekick/example-markup
 *
 */


@mixin when-two-children() {
  > :nth-last-child(n + 2),
  > :nth-last-child(n + 2) ~ * {
    @content;
  }
}


@mixin radius-component-hero-sidekick {
  $sidekick-indent: 2.5rem;
  $columns-2-1: get-columns-widths(2 1);
  $columns-3-1: get-columns-widths(3 1);
  $columns-66-33: 100 * 2/3, 100 * 1/3;
  $column-gap: 3rem;


  @include from(mobile-medium) {
    .hero-sidekick {
      position: relative;

      margin-top: -1 * $sidekick-indent; // pushes the sidekick upwards
    }


    .hero-sidekick::after {
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;

      display: block;
      width: 100%;
      height: 100%;

      content: "";
    }


    .hero-sidekick--alt {
      @include z-index(content);
      height: 0;
      margin-top: 0;


      &::after {
        content: none;
      }

      overflow: visible;

      > * {
        transform: translateY(-50%);
      }
    }
  }


  .hero-sidekick__content-grid {
    @include from(mobile-large) {
      display: flex;
      justify-content: space-between;
    }


    @include breakpoint(from mobile-large to desktop-medium) {
      flex-wrap: wrap;


      > * {
        // three columns with 3rem gap
        width: calc(#{100 / 3 * 1%} - #{2/3 * $column-gap});
      }


      > :last-child:nth-child(odd) {
        margin-right: calc(#{100/3 * 1%} + #{1/3 * $column-gap}); //stylelint-disable-line declaration-property-unit-whitelist
      }
    }


    @include from(desktop-medium) {
      > * {
        // five columns with 3rem gap
        width: calc(#{100 / 5 * 1%} - #{4/5 * $column-gap});
      }
    }
  }


  .hero-sidekick__content {
    @include page-grid-responsive;

    display: flex;
    align-items: center;
    flex-direction: column-reverse;
    padding-top: 1rem;

    background-color: get-color(purple);


    > * {
      @include column-padding;

      width: 100%;
    }


    @include from(mobile-medium) {
      flex-direction: row;
    }


    @include when-two-children() {
      // stylelint-disable block-opening-brace-space-before

      @include from(mobile-medium) {
        &.hero-sidekick__column-primary   { width: nth($columns-2-1, 1) * 1%; }
        &.hero-sidekick__column-secondary { width: nth($columns-2-1, 2) * 1%; }
      }


      @include from(mobile-large) {
        &.hero-sidekick__column-primary   { width: nth($columns-66-33, 1) * 1%; }
        &.hero-sidekick__column-secondary { width: nth($columns-66-33, 2) * 1%; }
      }


      @include from(desktop-small) {
        &.hero-sidekick__column-primary   { width: nth($columns-3-1, 1) * 1%; }
        &.hero-sidekick__column-secondary { width: nth($columns-3-1, 2) * 1%; }
      }


      &.hero-sidekick__content-grid {
        @include from(mobile-large)  {
          > * {
            // two columns with 3rem gap
            width: calc(#{100 / 2 * 1%} - #{1/2 * $column-gap});
          }
        }


        @include from(desktop-small) {
          > * {
            // four columns with 3rem gap
            width: calc(#{100 / 4 * 1%} - #{3/4 * $column-gap});
          }
        }
      }

      // stylelint-enable
    }
  }
}
