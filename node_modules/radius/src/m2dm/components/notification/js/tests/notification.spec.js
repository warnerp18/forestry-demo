import notification from '../index';

describe('notification', () => {
  const fixture = `
    <div data-js-notification-collapse>
      <h2>Lorem ipsum dolor sit amet, consectetur adipisicing elit.</h2>
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit.</p>
    </div>
  `;

  const WAITING_TIME = 10000;
  const COLLAPSED_CLASS = 'is-collapsed';

  let notificationEl;
  let notificationHeight;

  beforeEach(() => {
    document.body.innerHTML = fixture;
    notificationEl = document.querySelector('[data-js-notification-collapse]');
    notificationHeight = notificationEl.clientHeight;

    jasmine.clock().install();
    spyOn(window, 'requestAnimationFrame').and.callFake((fn) => {
      fn();
    });

    notification();
  });

  afterEach(() => {
    jasmine.clock().uninstall();
  });

  it('keeps the notification visible for <WAITING_TIME>', () => {
    jasmine.clock().tick(WAITING_TIME - 1);

    expect(notificationEl.clientHeight).toBe(notificationHeight);
  });

  describe('after <WAITING_TIME>', () => {
    it('sets the inline height', () => {
      jasmine.clock().tick(WAITING_TIME);

      expect(notificationEl.style.height).toBe(`${notificationHeight}px`);
    });

    it('adds the collapsed class', () => {
      jasmine.clock().tick(WAITING_TIME);

      expect(notificationEl.classList.contains(COLLAPSED_CLASS)).toBe(true);
    });
  });
});
