import cookieStatement from '../index';
import cookies from '../../../../globals/js/cookies';

const cookieObj = {
  cookieName: 'FCCookieStatement',
  cookieValue: true,
  cookieDays: -365,
  cookiePath: '/',
};

describe('cookieStatement', () => {
  beforeEach(() => {
    jasmine.getFixtures().fixturesPath = 'base/src/m2dm/components/cookie-statement/js/tests/fixtures';
    jasmine.getFixtures().load('cookie-statement-fixture.html');
  });

  afterEach(() => {
    cookies.setCookie(cookieObj);
  });

  describe('When there is no cookie', () => {
    beforeEach(() => {
      cookies.setCookie(cookieObj);
    });

    describe('on page load', () => {
      beforeEach(() => {
        cookieStatement();
      });

      it('should see the cookie statement', () => {
        expect(document.querySelector('[data-js-cookie-statement]')).toHaveClass('is-enabled');
      });
    });

    describe('when the user dismisses the statement', () => {
      beforeEach(() => {
        cookieStatement();
        document.querySelector('[data-js-cookie-statement-cta]').click();
      });

      it('should have a valid cookie', () => {
        expect(document.cookie).toBe('FCCookieStatement=true');
      });
    });
  });

  describe('When there is a cookie', () => {
    beforeEach(() => {
      cookies.setCookie(Object.assign({}, cookieObj, { cookieDays: 3650 }));
    });

    it('should not see the cookie statement', () => {
      expect(document.querySelector('[data-js-cookie-statement]')).not.toHaveClass('is-enabled');
    });
  });
});
