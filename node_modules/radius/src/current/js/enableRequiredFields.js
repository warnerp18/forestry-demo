import utils from './utils';

const FIELD_SELECTOR = 'data-required';

export default () => {
  utils.addEventListener(document.body, 'focus', onFocus, true);
  utils.addEventListener(document.body, 'submit', onSubmit, true);

  function onFocus(event) {
    const element = event.target;
    enableRequiredField(element);
  }

  function onSubmit(event) {
    const form = event.target;

    utils.forEach(
      form.querySelectorAll(`[${FIELD_SELECTOR}]`),
      enableRequiredField
    );

    if (!form.checkValidity()) {
      event.preventDefault();
    }
  }

  function enableRequiredField(element) {
    if (!utils.hasAttribute(element, FIELD_SELECTOR)) {
      return;
    }

    element.setAttribute('required', true);
    element.removeAttribute(FIELD_SELECTOR);
  }
};
