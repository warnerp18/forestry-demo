import $ from 'jquery';
import sidenav from '../sidenav';

describe('Sidenav with default settings', () => {
  beforeEach(() => {
    sharedBehaviorBefore();
    sidenav();
  });

  afterEach(sharedBehaviorAfter);

  it('should not change the text of the button by default', () => {
    const secondLink = document.querySelector('a.side-nav__item:last-of-type');
    const toggleTextEl = document.querySelector('.js-r-toggle-text');
    const toggleTextInitialContent = toggleTextEl.textContent;

    document.querySelector('.js-r-sidenav').classList.add('is-active');
    triggerClickEvent(secondLink);
    expect(toggleTextEl.textContent === toggleTextInitialContent).toBe(true);
  });
});

describe('Sidenav without an element to bind to', () => {
  it('should not die', () => {
    expect(sidenav).not.toThrow();
  });
});

function sharedBehaviorBefore() {
  const fixture = `
    <div class="side-nav u-clear-float--pseudo js-r-sidenav">
      <nav class="side-nav__navigation" role="navigation">
        <a href="#values" class="side-nav__item is-active">Values</a>
        <a href="#history" class="side-nav__item">History</a>
      </nav>
      <button class="side-nav__item side-nav__toggle js-r-sidenav-toggle">
        <span class="js-r-toggle-text">Values</span>
        <span class="side-nav__triangle"></span>
      </button>
    </div>
  `;

  $('body').append(fixture);
}

function sharedBehaviorAfter() {
  $('body').empty();
}

function triggerClickEvent(element) {
  const event = new MouseEvent('click');
  element.dispatchEvent(event);
}
